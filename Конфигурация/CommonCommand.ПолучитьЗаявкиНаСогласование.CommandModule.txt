Процедура ПолучитьЗаявкиНаСогласование()
	Перем Соединение;
	Соединение = ОбменСАБФ.ПодключитьСервис();
	тПользователь = Константы.Пользователь.Получить();
	тПароль = Константы.Пароль.Получить();
	Соединение.Пользователь = тПользователь;
	Результат = Соединение.ReadTasks(тПользователь,тПароль);
	Данные = Результат.Получить();
	Если ТипЗнч(Данные)=Тип("Структура") тогда
		
		Если Данные.Свойство ("СтатусВозврата")=Неопределено тогда
			Сообщить ("Неверно сформирована структура ответа! Не обнаружен статус возврата. Обратитесь к разработчикам!", СтатусСообщения.ОченьВажное);
			возврат;
		КонецЕсли;
		
		СтатусВозврата = Данные.СтатусВозврата;
		
		Если Не СтатусВозврата Тогда
			Сообщить ("Cервису не удалось сформировать список заявок! Проверьте логин и пароль!", СтатусСообщения.ОченьВажное);
			возврат;
		КонецЕсли;
		
		Если Данные.Свойство ("ЗаявкиПереданные") = Неопределено тогда
			Сообщить ("Неверно сформирована структура ответа! Не обнаружена таблица с переданными заявками. Обратитесь к разработчикам!", СтатусСообщения.ОченьВажное);
			возврат;
		КонецЕсли;
		
		тзЗаявкиПереданные = Данные.ЗаявкиПереданные;
		рсвЗаявкиПереданные = РегистрыСведений.ЗаявкиПереданные.СоздатьНаборЗаписей();
		рсвЗаявкиПереданные.Загрузить(тзЗаявкиПереданные);
		
		для каждого эл из рсвЗаявкиПереданные цикл
			эл.Состояние = Перечисления.СостояниеЗаявки.НеОбработана;
		КонецЦикла;
		
		Попытка
			рсвЗаявкиПереданные.Записать(истина);
		Исключение
			Сообщить ("При записи изменений возникла ошибка: "+ОписаниеОшибки(),СтатусСообщения.ОченьВажное);
		КонецПопытки;
		
	иначе
		Сообщить ("Сервис вернул неверную структуру ответа!",СтатусСообщения.ОченьВажное);
	конецесли;
КонецПроцедуры


&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	ПолучитьЗаявкиНаСогласование();
	Оповестить ("ЗагруженыЗаявкиПереданные");
КонецПроцедуры
