&НаСервере
// Создает запись в регистре сведений наряд-заказы
//
// Параметры:
//	<ПараметрыНЗ>	- Структура:
//  <ДатаНЗ>  		- <Дата.Дата и время> - дата наряд-заказа
//  <НомерНЗ>  		- <Строка (15)> - номер наряд-заказа
//  <ДатаЗаявки>  	- <Дата.Дата и время> - дата заявки
//  <НомерЗаявки>	- <Строка (15)> - Номер заявки
//
Процедура СоздатьНЗСервер(ПараметрыНЗ)
	рсвНЗ = РегистрыСведений.НЗ.СоздатьМенеджерЗаписи();
	рсвНЗ.Заполнить(ПараметрыНЗ);
КонецПроцедуры // СоздатьНЗСервер()

&НаКлиенте
Процедура ВвестиСобытие(Команда)
	ПарЗаполнения = новый структура;
	ПарЗаполнения.Вставить("ДатаЗаявки" , Запись.Дата);
	ПарЗаполнения.Вставить("Контрагент" , Запись.Контрагент);
	ПарЗаполнения.Вставить("НомерЗаявки", Запись.Номер);
	ОткрытьФорму("РегистрСведений.События.ФормаЗаписи", ПарЗаполнения);
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ТекстЗаявки	= Вспомогательный.СформироватьТекстЗаявкиHTML(Запись);
	ТекстПроезд	= Вспомогательный.СформироватьКонтактнуюИнформацию(Запись);
КонецПроцедуры

&НаКлиенте
Процедура КонтактнаяИнформацияПриНажатии(Элемент, ДанныеСобытия, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	стрСсылка = ДанныеСобытия.href;
	#Если МобильноеПриложениеКлиент тогда
		
		//обработка нажатия ссылки на адрес
		Если Найти (стрСсылка,"geo:") > 0 тогда
			стрКоорд = Гео.ПолучитьКоординатыПоАдресу(стрСсылка);
			Если стрКоорд <> ложь тогда
				ЗапуститьПриложение("geo:"+стрКоорд);
			иначе
				Сообщить ("Не удалось определить координаты адреса. Проверьте интернет подключение.",СтатусСообщения.ОченьВажное);
			КонецЕсли;
		КонецЕсли;
		
		//обработка нажатия ссылки на телефон
		Если Найти (стрСсылка,"tel:") > 0 тогда
			СредстваТелефонии.НабратьНомер(СтрЗаменить (стрСсылка,"tel:",""), ложь);
		КонецЕсли;
	#иначе
		Сообщить (""+стрСсылка);
	#КонецЕсли
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	эл = РеквизитФормыВЗначение("Запись");
	НЗ.Параметры.УстановитьЗначениеПараметра("ДатаЗаявки"	, эл.Дата);
	НЗ.Параметры.УстановитьЗначениеПараметра("НомерЗаявки"	, эл.Номер);
КонецПроцедуры

&НаКлиенте
Процедура СоздатьНЗ(Команда)
	тДата = ТекущаяДата();
	стрПараметры = Новый Структура;
	стрПараметры.Вставить("ДатаНЗ"		, тДата);
	стрПараметры.Вставить("НомерНЗ"		, "новый"+Формат (тДата,"ДФ=hhmmss"));
	стрПараметры.Вставить("ДатаЗаявки"	, Запись.Дата);
	стрПараметры.Вставить("НомерЗаявки"	, Запись.Номер);
	СоздатьНЗСервер(стрПараметры);
	ОткрытьФорму("РегистрСведений.НЗ.ФормаЗаписи"		, стрПараметры);
КонецПроцедуры

