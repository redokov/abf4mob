&НаСервере
функция ПолучитьДанныеЗаявки (Знач Состояние, Знач Дата, Знач Номер)
	рез = новый структура;
	Если ТипЗнч(Состояние) = Тип("ПеречислениеСсылка.СостояниеЗаявкиПринятые") тогда //получим данные принятой заявки
		рсв = РегистрыСведений.ЗаявкиПринятые.СоздатьМенеджерЗаписи();
		рсв.Состояние = Состояние;
		рсв.Дата = Дата;
		рсв.Номер = Номер;
		рсв.Прочитать();
		рез.Вставить("Заявка",рсв.Заявка);
		рез.Вставить("КонтактнаяИнформация",""+рсв.КонтактноеЛицо+" <br/> "+рсв.КонтактнаяИнформация);
		рез.Вставить("Метро",рсв.Метро);
		рез.Вставить("МаршрутПроезда",рсв.МаршрутПроезда);
		возврат рез;
	ИначеЕсли  ТипЗнч(Состояние) = Тип("ПеречислениеСсылка.СостояниеЗаявкиПереданные") тогда //получим данные переданной заявки
		рсв = РегистрыСведений.ЗаявкиПереданные.СоздатьМенеджерЗаписи();
		рсв.Состояние = Состояние;
		рсв.Дата = Дата;
		рсв.Номер = Номер;
		рсв.Прочитать();
		рез.Вставить("Заявка",рсв.Заявка);
		рез.Вставить("КонтактнаяИнформация"," "+рсв.КонтактноеЛицо+" <br/> "+рсв.КонтактнаяИнформация);
		рез.Вставить("Метро",рсв.Метро);
		рез.Вставить("МаршрутПроезда",рсв.МаршрутПроезда);
		возврат рез;
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура СписокЗаявокПриАктивизацииПоля(Элемент)
	// Вставить содержимое обработчика.
	ТекДанные = Элемент.ТекущиеДанные;
	Если ТекДанные <> Неопределено тогда
		Состояние = ТекДанные.Состояние;
		Дата = ТекДанные.Дата;
		Номер = ТекДанные.Номер;
		рез = ПолучитьДанныеЗаявки(Состояние,Дата,Номер);
		Если рез = ложь тогда
			Сообщить ("Неверно определена заявка");
			возврат;
		КонецЕсли;
		ТекстЗаявки = "<html><head></head><body bgcolor=FCFAEB>Заявка: " + рез.Заявка +?(ЗначениеЗаполнено (рез.Метро),"<br> Ближайшее метро: " +рез.Метро,"") + " <br> Контакты: "+рез.КонтактнаяИнформация+"</body></html>";
	иначе
		ТекстЗаявки = "<html><head></head><body bgcolor=FCFAEB></body></html>";
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	//Вставить содержимое обработчика
	Если ИмяСобытия="ЗагруженыЗаявкиПереданные" тогда
		Элементы.ЗаявкиПереданные.Обновить();
		Элементы.ЗаявкиПринятые.Обновить();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура КонтактнаяИнформацияПриНажатии(Элемент, ДанныеСобытия, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	СтандартнаяОбработка = ложь;
	#Если МобильноеПриложениеКлиент тогда
		СредстваТелефонии.НабратьНомер(СтрЗаменить (ДанныеСобытия.href,"tel:",""), ложь);
	#иначе
		Сообщить (""+СтрЗаменить (ДанныеСобытия.href,"tel:",""));
	#КонецЕсли
КонецПроцедуры

&НаКлиенте
Процедура ЗаявкиПриСменеСтраницы(Элемент, ТекущаяСтраница)
	// Вставить содержимое обработчика.
	Если ТекущаяСтраница.Имя = "стрЗаявкиПереданные" тогда
		стр = Элементы.ЗаявкиПереданные.ТекущиеДанные;
	иначе
		стр = Элементы.ЗаявкиПринятые.ТекущиеДанные;
	КонецЕсли;
	Если стр = неопределено тогда
		ТекстЗаявки = "<html><head></head><body bgcolor=FCFAEB></body></html>";
		возврат;
	КонецЕсли;
	Состояние = стр.Состояние;
	Дата = стр.Дата;
	Номер = стр.Номер;
	рез = ПолучитьДанныеЗаявки(Состояние, Дата, Номер);
	Если рез = ложь тогда
		Сообщить ("Неверно определена заявка");
		возврат;
	КонецЕсли;
	ТекстЗаявки = "<html><head></head><body bgcolor=FCFAEB>Заявка: " + рез.Заявка +?(ЗначениеЗаполнено (рез.Метро),"<br> Ближайшее метро: " +рез.Метро,"") + " <br> Контакты: "+рез.КонтактнаяИнформация+"</body></html>";
КонецПроцедуры


&НаКлиенте
Процедура ЗаявкиПереданныеВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ОткрытьФорму ("РегистрСведений.ЗаявкиПереданные.ФормаЗаписи", Новый Структура ("Ключ",ВыбраннаяСтрока));
	СтандартнаяОбработка = ложь;
КонецПроцедуры

