Процедура ОтправитьЗаявкиПереданныеНаСервер()
	стрРезультат = Новый Структура();
	
	КС = Новый КвалификаторыСтроки(20);
	масТип = Новый Массив();
	масТип.Добавить(Тип("Строка"));
	Тип = Новый ОписаниеТипов(масТип, , КС);

	//Сформируем список принятых заявок
	тзЗаявкиПринятые = Новый ТаблицаЗначений();
	тзЗаявкиПринятые.Колонки.Добавить("Состояние",Тип);
	тзЗаявкиПринятые.Колонки.Добавить("Дата",Тип);
	тзЗаявкиПринятые.Колонки.Добавить("Номер",Тип);
	тзЗаявкиПринятые.Колонки.Добавить("СрокИсполнения",Тип);
	
	Отбор = Новый Структура("Состояние");
	Отбор.Состояние = Перечисления.СостояниеЗаявки.Принята;
	регЗаявкиПереданные = РегистрыСведений.ЗаявкиПереданные.Выбрать(Отбор);
	Пока регЗаявкиПереданные.Следующий() цикл
		стр = тзЗаявкиПринятые.Добавить();
		стр.Состояние = "Принята";
		стр.Дата = регЗаявкиПереданные.Дата;
		стр.Номер = регЗаявкиПереданные.Номер;
		стр.СрокИсполнения = регЗаявкиПереданные.СрокИсполнения;
	КонецЦикла;
	
	стрРезультат.Вставить("ЗаявкиПринятые", тзЗаявкиПринятые);
	
	//Сформируем список непринятых заявок
	тзЗаявкиНеПринятые = Новый ТаблицаЗначений();
	тзЗаявкиНеПринятые.Колонки.Добавить("Состояние",Тип);
	тзЗаявкиНеПринятые.Колонки.Добавить("Дата",Тип);
	тзЗаявкиНеПринятые.Колонки.Добавить("Номер",Тип);
	тзЗаявкиНеПринятые.Колонки.Добавить("СрокИсполнения",Тип);
	
	Отбор = Новый Структура("Состояние");
	Отбор.Состояние = Перечисления.СостояниеЗаявки.Отклонена;
	регЗаявкиПереданные = РегистрыСведений.ЗаявкиПереданные.Выбрать(Отбор);
	Пока регЗаявкиПереданные.Следующий() цикл
		стр = тзЗаявкиНеПринятые.Добавить();
		стр.Состояние = "Отклонена";
		стр.Дата = регЗаявкиПереданные.Дата;
		стр.Номер = регЗаявкиПереданные.Номер;
		стр.СрокИсполнения = регЗаявкиПереданные.СрокИсполнения;
	КонецЦикла;
	
	стрРезультат.Вставить("ЗаявкиНеПринятые", тзЗаявкиНеПринятые);
	
	//Передадим данные на сервер
	Соединение = ОбменСАБФ.ПодключитьСервис();
	Соединение.Пользователь = Константы.Пользователь.Получить();
	стрРезультат = Новый ХранилищеЗначения (стрРезультат, Новый СжатиеДанных(9));
	Результат = Соединение.WriteStory(стрРезультат);
	Если Не Результат тогда
		Сообщить ("Ошибка при передаче данных на сервер",СтатусСообщения.ОченьВажное);
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	ОтправитьЗаявкиПереданныеНаСервер()
КонецПроцедуры
