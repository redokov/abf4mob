Процедура ОтправитьЗаявкиПереданныеНаСервер()
	стрРезультат = Новый Структура();
	
	КС = Новый КвалификаторыСтроки(20);
	масТип = Новый Массив();
	масТип.Добавить(Тип("Строка"));
	Тип = Новый ОписаниеТипов(масТип, , КС);

	//Сформируем список принятых заявок
	тзЗаявки = Новый ТаблицаЗначений();
	тзЗаявки.Колонки.Добавить("Состояние",Тип);
	тзЗаявки.Колонки.Добавить("Дата",Тип);
	тзЗаявки.Колонки.Добавить("Номер",Тип);
	тзЗаявки.Колонки.Добавить("СрокИсполнения",Тип);
	
	//добавим в результирующую таблицу заявки принятые
	Отбор = Новый Структура("Состояние");
	Отбор.Состояние = Перечисления.СостояниеЗаявкиПереданные.Принята;
	регЗаявкиПереданные = РегистрыСведений.ЗаявкиПереданные.Выбрать(Отбор);
	Пока регЗаявкиПереданные.Следующий() цикл
		стр = тзЗаявки.Добавить();
		стр.Состояние = "Принята";
		стр.Дата = регЗаявкиПереданные.Дата;
		стр.Номер = регЗаявкиПереданные.Номер;
		стр.СрокИсполнения = регЗаявкиПереданные.СрокИсполнения;
	КонецЦикла;
	
	//добавим в результирующую таблицу заявки отклоненные
	Отбор = Новый Структура("Состояние");
	Отбор.Состояние = Перечисления.СостояниеЗаявкиПереданные.Отклонена;
	регЗаявкиПереданные = РегистрыСведений.ЗаявкиПереданные.Выбрать(Отбор);
	Пока регЗаявкиПереданные.Следующий() цикл
		стр = тзЗаявки.Добавить();
		стр.Состояние = "Отклонена";
		стр.Дата = регЗаявкиПереданные.Дата;
		стр.Номер = регЗаявкиПереданные.Номер;
		стр.СрокИсполнения = регЗаявкиПереданные.СрокИсполнения;
	КонецЦикла;
	
	//добавим в результирующую таблицу заявки в работе
	Отбор = Новый Структура("Состояние");
	Отбор.Состояние = Перечисления.СостояниеЗаявкиПринятые.ВРаботе;
	регЗаявкиПринятые = РегистрыСведений.ЗаявкиПринятые.Выбрать(Отбор);
	Пока регЗаявкиПринятые.Следующий() цикл
		стр = тзЗаявки.Добавить();
		стр.Состояние = "В работе";
		стр.Дата = регЗаявкиПринятые.Дата;
		стр.Номер = регЗаявкиПринятые.Номер;
		стр.СрокИсполнения = регЗаявкиПринятые.СрокИсполнения;
	КонецЦикла;
	
	//добавим в результирующую таблицу отработанные заявки 
	Отбор = Новый Структура("Состояние");
	Отбор.Состояние = Перечисления.СостояниеЗаявкиПринятые.Отработана;
	регЗаявкиПринятые = РегистрыСведений.ЗаявкиПринятые.Выбрать(Отбор);
	Пока регЗаявкиПринятые.Следующий() цикл
		стр = тзЗаявки.Добавить();
		стр.Состояние = "Отработана";
		стр.Дата = регЗаявкиПринятые.Дата;
		стр.Номер = регЗаявкиПринятые.Номер;
		стр.СрокИсполнения = регЗаявкиПринятые.СрокИсполнения;
	КонецЦикла;	
	
	стрРезультат.Вставить("Заявки", тзЗаявки);
	
	//Выгрузим события
	тзСобытия = Новый ТаблицаЗначений;
	регСобытия = РегистрыСведений.События.СоздатьНаборЗаписей();
	регСобытия.Прочитать();
	тзСобытия = регСобытия.Выгрузить();
	стрРезультат.Вставить("События", тзСобытия);
	
	//Передадим данные на сервер
	Соединение = ОбменСАБФ.ПодключитьСервис();
	Соединение.Пользователь = Константы.Пользователь.Получить();
	стрРезультат = Новый ХранилищеЗначения (стрРезультат, Новый СжатиеДанных(9));
	Результат = Соединение.WriteStory(стрРезультат);
	Если Не Результат тогда
		Сообщить ("Ошибка при передаче данных на сервер",СтатусСообщения.ОченьВажное);
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	ОтправитьЗаявкиПереданныеНаСервер()
КонецПроцедуры
